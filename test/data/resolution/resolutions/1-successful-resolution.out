Final version.
All conflicts fixed.